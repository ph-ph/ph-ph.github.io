<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>Hammerspoon - Dzmitry Kishylau</title>
<meta name=description content="How to quickly add MacOS automations using Lua.">
<meta name=author content>
<link rel=icon type=image/x-icon href=https://blog.dkishylau.com/images/favicon-light.ico>
<link rel=apple-touch-icon href=https://blog.dkishylau.com/images/apple-touch-icon-light.png>
<link rel=stylesheet type=text/css title=light id=light href=https://blog.dkishylau.com/stylesheets/light.css>
<link rel=stylesheet type=text/css title=dark id=dark href=https://blog.dkishylau.com/stylesheets/dark.css disabled>
<link rel="preload stylesheet" as=style href=https://blog.dkishylau.com/custom.min.css>
<link rel="preload stylesheet" as=style href=https://blog.dkishylau.com/an-old-hope.min.css>
<script defer src=https://blog.dkishylau.com/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<meta name=generator content="Hugo 0.92.2">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TECK8WVZ2"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-4TECK8WVZ2',{anonymize_ip:!1})}</script>
<meta property="og:title" content="Hammerspoon">
<meta property="og:description" content="How to quickly add MacOS automations using Lua.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.dkishylau.com/posts/hammerspoon/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-10-03T09:44:42-07:00">
<meta property="article:modified_time" content="2022-10-03T09:44:42-07:00">
<meta itemprop=name content="Hammerspoon">
<meta itemprop=description content="How to quickly add MacOS automations using Lua."><meta itemprop=datePublished content="2022-10-03T09:44:42-07:00">
<meta itemprop=dateModified content="2022-10-03T09:44:42-07:00">
<meta itemprop=wordCount content="555">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Hammerspoon">
<meta name=twitter:description content="How to quickly add MacOS automations using Lua.">
</head>
<body>
<main class=main>
<div class="grid grid-centered">
<div class=grid-cell>
<nav class="header-nav scrollappear">
<a href=/ class=header-logo title="Dzmitry Kishylau">Dzmitry Kishylau</a>
<ul class=header-links>
<li>
<a href=/about title=About><svg xmlns="http://www.w3.org/2000/svg" class="icon-about"><use href="https://blog.dkishylau.com/icons/about.svg#icon-about" xlink:href="https://blog.dkishylau.com/icons/about.svg#icon-about"/></svg>
</a>
</li>
<li>
<a href=https://github.com/ph-ph rel="noreferrer noopener" target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon-github"><use href="https://blog.dkishylau.com/icons/github.svg#icon-github" xlink:href="https://blog.dkishylau.com/icons/github.svg#icon-github"/></svg>
</a>
</li>
<li>
<a href=https://twitter.com/dkishylau rel="noreferrer noopener" target=_blank title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter"><use href="https://blog.dkishylau.com/icons/twitter.svg#icon-twitter" xlink:href="https://blog.dkishylau.com/icons/twitter.svg#icon-twitter"/></svg>
</a>
</li>
<li>
<a href=/index.xml rel="noreferrer noopener" target=_blank title=RSS><svg xmlns="http://www.w3.org/2000/svg" class="icon-rss"><use href="https://blog.dkishylau.com/icons/rss.svg#icon-rss" xlink:href="https://blog.dkishylau.com/icons/rss.svg#icon-rss"/></svg>
</a>
</li>
<li>
<a onclick=toggle() title="Toggle Theme"><svg xmlns="http://www.w3.org/2000/svg" class="icon-theme"><use href="https://blog.dkishylau.com/icons/theme.svg#icon-theme" xlink:href="https://blog.dkishylau.com/icons/theme.svg#icon-theme"/></svg>
</a>
</li>
</ul>
</nav>
<article class="article scrollappear">
<header class=article-header>
<h1>Hammerspoon</h1>
<div class=article-list-footer>
<span class=article-list-date>
Oct 3, 2022
</span>
<span class=article-list-divider>-</span>
<span class=article-list-minutes>
3 minute read
</span>
</div>
</header>
<div class=article-content>
<p>Another productivity post! This time I had to learn Lua so that I could switch to my headphones via keyboard shortcut.</p>
<h1 id=the-problem>The problem</h1>
<p>My MacBook Pro is often connected to 3 audio devices: its own built-in speakers, bluetooth headphones and an audio interface with another pair of headphones and potentially another microphone plugged into it. MacBook tries its best at guessing which audio device I want to use at any point in time, and sometimes it gets it wrong in non-obvious ways. Like, it would choose to use bluetooth headphones as an output device and audio interface as an input device - I&rsquo;ve had several Zoom calls derailed by that, and though rare, it&rsquo;s pretty annoying.</p>
<p>It&rsquo;s possible that macOS will become smarter over time, but for now I really needed two simple things:</p>
<ul>
<li>a quick way to see exactly which device is used for input and output.</li>
<li>a quick way to tell macOS to use the device of my choice.</li>
</ul>
<p>&ldquo;A quick way&rdquo; usually means a keyboard shortcut - navigating audio settings UX in MacOS with a mouse is a frustrating experience, especially in the middle of an important video call.</p>
<h1 id=hammerspoon>Hammerspoon</h1>
<p>I was able to build exactly what I needed using <a href=https://www.hammerspoon.org/>Hammerspoon</a>. Hammerspoon allows you to write macOS automation scripts in Lua and bind them to keyboard shortcuts. It provides access to a wide range of APIs, from controlling window layout to managing various devices.</p>
<p>For my problem, I wrote a short <a href=https://github.com/ph-ph/phph_configs/blob/master/init.lua>script in Lua</a> that configures 4 keybindings:</p>
<ul>
<li>3 are used to select a specific audio device.</li>
<li>The last one shows what&rsquo;s currently used for input and output, using a non-intrusive overlay text.</li>
</ul>
<figure><img src=/img/hammerspoon_overlay.png alt="Overlay text showing my current input and output devices"><figcaption>
<p>Overlay text showing my current input and output devices</p>
</figcaption>
</figure>
<p>The script is straightforward, but it does require some non-trivial knowledge about how audio device API works exactly, and which device ids should be used. Fortunately, Hammerspoon has a simple REPL console where I could play with API, inspect its outputs and test my assumptions. I also didn&rsquo;t know much about Lua, and having a quick and easy way to test my code made the whole coding experience rather fun.</p>
<p>For comparison, here&rsquo;s how the same problem is solved using AppleScript: <a href=https://plasticmind.com/code/audio-output-toggle-applescript/>https://plasticmind.com/code/audio-output-toggle-applescript/</a> . I think Lua code is easier to understand and is not as UI-dependent, and I love the fact that I don&rsquo;t have to use clunky Apple dev tools to develop my scripts, or port them to another laptop.</p>
<h1 id=more-uses-for-hammerspoon>More uses for Hammerspoon</h1>
<p>I&rsquo;ve been using my keyboard shortcuts for several months now, and I&rsquo;m pretty happy with them - no more awkward Zoom meetings and clicking around device settings in GarageBand.</p>
<p>That said, I haven&rsquo;t used Hammerspoon for anything else yet. I think it&rsquo;s more due to the lack of imagination and not having a lot of workflows to automate. My typical workflow these days is opening a tab in Chrome or Slack and reading it ðŸ˜­. I do think that it might be useful for doing quick stuff in time-sensitive situations, like hiding all the stuff except the browser window when you&rsquo;re about to share the screen. It can also help with automating complex setups - some people really like their apps to be arranged in a certain way on the screen, and not having to manually restore the layout after a reboot should be nice.</p>
</div>
<div class=article-share>
<a href="https://twitter.com/intent/tweet?text=Hammerspoon&url=https%3a%2f%2fblog.dkishylau.com%2fposts%2fhammerspoon%2f" title="Share on Twitter" rel="noreferrer noopener" target=_blank><svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6-18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5.0-96.8 43.4-96.8 96.9.0 7.6.8 15 2.5 22.1-80.5-4-151.9-42.6-199.6-101.3-8.3 14.3-13.1 31-13.1 48.7.0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 .4.0.8.0 1.2.0 47 33.4 86.1 77.7 95-8.1 2.2-16.7 3.4-25.5 3.4-6.2.0-12.3-.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3-33.1 26-74.9 41.5-120.3 41.5-7.8.0-15.5-.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-.1-8.4-.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
</a>
<a href="https://www.facebook.com/sharer/sharer.php?href=https%3a%2f%2fblog.dkishylau.com%2fposts%2fhammerspoon%2f" title="Share on Facebook" rel="noreferrer noopener" target=_blank><svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5.0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
</a>
</div>
</article>
<footer class="footer scrollappear">
<p>
<span>&copy; 2022 <a href=https://blog.dkishylau.com/>Dzmitry Kishylau</a></span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></span>
<span>Theme is based on <a href=https://github.com/nielsenramon/chalk rel="noreferrer noopener" target=_blank>Chalk</a></span>
</p>
</footer>
</div>
</div>
</main>
<script src=https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/zooming.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/retina.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/svgxuse.min.js></script>
<script src=https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js></script>
<script src=https://blog.dkishylau.com/javascripts/vendor.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/webfonts.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/scrollappear.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/application.min.js></script>
<script src=https://blog.dkishylau.com/javascripts/themetoggle.min.js></script>
</body>
</html>